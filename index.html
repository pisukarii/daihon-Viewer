<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Stage Script Viewer Pro</title>
    <style>
        :root {
            --bg-color: #121212;
            --panel-color: #252525;
            --accent-color: #007bff;
            --lock-color: #d32f2f;
            --text-color: #e0e0e0;
        }

        body, html {
            margin: 0; padding: 0; height: 100%; width: 100%;
            font-family: 'Helvetica Neue', Arial, sans-serif;
            background: var(--bg-color); color: var(--text-color);
            overflow: hidden;
        }

        /* æ™‚è¨ˆï¼ˆé€šå¸¸æ™‚ãƒ»ä¸Šéƒ¨ä¸­å¤®ï¼‰ */
        #clock {
            position: fixed; top: 0; left: 50%; transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.8); padding: 5px 25px;
            border-bottom-left-radius: 15px; border-bottom-right-radius: 15px;
            font-size: 1.2rem; z-index: 100; font-weight: bold;
        }

        .container { display: flex; height: 100vh; width: 100vw; }

        /* PDFè¡¨ç¤ºã‚¨ãƒªã‚¢ */
        #viewer-area { flex-grow: 1; background: #333; position: relative; }
        iframe { width: 100%; height: 100%; border: none; }

        /* ã‚µã‚¤ãƒ‰ãƒ‘ãƒãƒ« */
        #sidebar {
            width: 320px; background: var(--panel-color);
            display: flex; flex-direction: column; border-left: 1px solid #444;
        }

        .config-area { padding: 15px; border-bottom: 1px solid #444; }
        .config-area input {
            width: 100%; background: #333; border: 1px solid #555; color: white;
            padding: 8px; box-sizing: border-box; border-radius: 5px;
        }

        #file-list { flex-grow: 1; overflow-y: auto; padding: 10px; }
        .file-item {
            background: #333; margin-bottom: 8px; padding: 10px;
            border-radius: 8px; display: flex; align-items: center; justify-content: space-between;
        }
        .file-item.active { border-left: 5px solid var(--accent-color); background: #3d3d3d; }
        .file-name { flex-grow: 1; cursor: pointer; padding-right: 10px; overflow: hidden; text-overflow: ellipsis; }
        .edit-btn { cursor: pointer; opacity: 0.6; font-size: 0.8rem; border: 1px solid #666; padding: 2px 5px; border-radius: 4px; }

        .controls { padding: 15px; background: #1a1a1a; }
        .btn {
            display: block; width: 100%; padding: 15px; margin-bottom: 10px;
            border: none; border-radius: 10px; cursor: pointer; font-size: 1rem; font-weight: bold;
        }
        .btn-upload { background: var(--accent-color); color: white; }
        .btn-lock { background: var(--lock-color); color: white; }

        /* ãƒ­ãƒƒã‚¯ç”»é¢ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ */
        #lock-screen {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #000; z-index: 10000; flex-direction: column;
            justify-content: center; align-items: center; text-align: center;
        }
        #lock-performance-name { font-size: 2rem; color: #aaa; margin-bottom: 20px; }
        #lock-clock { font-size: 8rem; font-weight: bold; color: #fff; margin-bottom: 40px; }
        #unlock-hint { color: #555; font-size: 1rem; }

        /* ãƒ¢ãƒ¼ãƒ€ãƒ« */
        .modal {
            display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
            background: #333; padding: 25px; border-radius: 15px; z-index: 1001; width: 300px;
        }
        .modal-mask { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 1000; }
    </style>
</head>
<body>

<div id="clock">00:00:00</div>

<div id="lock-screen" oncontextmenu="return false;">
    <div id="lock-performance-name">å…¬æ¼”åæœªè¨­å®š</div>
    <div id="lock-clock">00:00:00</div>
    <button class="btn" style="width:200px; background:#222; color:#666;" id="unlock-trigger">é•·æŠ¼ã—ã§è§£é™¤</button>
    <div id="unlock-hint">Hold to Unlock</div>
</div>

<div class="container">
    <div id="viewer-area">
        <iframe id="pdf-viewer" src=""></iframe>
    </div>

    <div id="sidebar">
        <div class="config-area">
            <label style="font-size:0.8rem; color:#888;">å…¬æ¼”å/ç¾å ´å</label>
            <input type="text" id="performance-input" placeholder="ä¾‹ï¼šå†¬ã®æ¼”åŠ‡ç¥­2024" oninput="updatePerfName()">
        </div>
        
        <div id="file-list">
            <p style="text-align:center; color:#666; margin-top:20px;">PDFã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ãã ã•ã„</p>
        </div>
        
        <div class="controls">
            <input type="file" id="file-input" accept="application/pdf" multiple style="display:none;" onchange="handleFiles(this.files)">
            <button class="btn btn-upload" onclick="document.getElementById('file-input').click()">ï¼‹ PDFä¸€æ‹¬è¿½åŠ </button>
            <button class="btn btn-lock" onclick="toggleLock(true)">ğŸ”’ ç”»é¢ãƒ­ãƒƒã‚¯ (æœ¬ç•ªãƒ¢ãƒ¼ãƒ‰)</button>
        </div>
    </div>
</div>

<div class="modal-mask" id="modal-mask" onclick="closeModal()"></div>
<div class="modal" id="edit-modal">
    <h3 style="margin-top:0;">è¡¨ç¤ºåã®å¤‰æ›´</h3>
    <select id="preset-select" onchange="document.getElementById('edit-name-input').value=this.value" style="width:100%; padding:8px; margin-bottom:10px;">
        <option value="">ã‚«ã‚¹ã‚¿ãƒ å…¥åŠ›</option>
        <option value="å°æœ¬">å°æœ¬</option>
        <option value="é€²è¡Œè¡¨">é€²è¡Œè¡¨</option>
        <option value="é¦™ç›¤è¡¨">é¦™ç›¤è¡¨</option>
        <option value="éŸ³éŸ¿ãƒªã‚¹ãƒˆ">éŸ³éŸ¿ãƒªã‚¹ãƒˆ</option>
        <option value="ç…§æ˜ãƒ—ãƒ­ãƒƒãƒˆ">ç…§æ˜ãƒ—ãƒ­ãƒƒãƒˆ</option>
    </select>
    <input type="text" id="edit-name-input" style="width:100%; padding:8px; box-sizing:border-box;">
    <button class="btn btn-upload" style="margin-top:15px;" onclick="saveNewName()">ä¿å­˜</button>
</div>

<script>
    let files = [];
    let currentEditIndex = null;
    let lockTimer;

    // æ™‚è¨ˆæ›´æ–°
    function updateClock() {
        const now = new Date();
        const timeStr = now.getHours().toString().padStart(2, '0') + ':' +
                        now.getMinutes().toString().padStart(2, '0') + ':' +
                        now.getSeconds().toString().padStart(2, '0');
        document.getElementById('clock').textContent = timeStr;
        document.getElementById('lock-clock').textContent = timeStr;
    }
    setInterval(updateClock, 1000);

    function updatePerfName() {
        document.getElementById('lock-performance-name').textContent = document.getElementById('performance-input').value || "å…¬æ¼”åæœªè¨­å®š";
    }

    // ãƒ•ã‚¡ã‚¤ãƒ«å‡¦ç†
    function handleFiles(selectedFiles) {
        for (let file of selectedFiles) {
            const fileURL = URL.createObjectURL(file);
            files.push({ name: file.name, url: fileURL });
        }
        renderList();
        if (files.length === selectedFiles.length) loadPDF(0); // åˆå›èª­ã¿è¾¼ã¿
    }

    function renderList() {
        const list = document.getElementById('file-list');
        list.innerHTML = '';
        files.forEach((file, i) => {
            const item = document.createElement('div');
            item.className = 'file-item' + (document.getElementById('pdf-viewer').src.includes(file.url) ? ' active' : '');
            item.innerHTML = `
                <div class="file-name" onclick="loadPDF(${i})">${file.name}</div>
                <div class="edit-btn" onclick="openEditModal(${i})">ç·¨é›†</div>
            `;
            list.appendChild(item);
        });
    }

    function loadPDF(index) {
        const viewer = document.getElementById('pdf-viewer');
        viewer.src = files[index].url + "#toolbar=1";
        renderList();
    }

    // åå‰ç·¨é›†
    function openEditModal(index) {
        currentEditIndex = index;
        document.getElementById('edit-name-input').value = files[index].name;
        document.getElementById('modal-mask').style.display = 'block';
        document.getElementById('edit-modal').style.display = 'block';
    }

    function closeModal() {
        document.getElementById('modal-mask').style.display = 'none';
        document.getElementById('edit-modal').style.display = 'none';
    }

    function saveNewName() {
        const newName = document.getElementById('edit-name-input').value;
        if (newName) {
            files[currentEditIndex].name = newName;
            renderList();
            closeModal();
        }
    }

    // ãƒ­ãƒƒã‚¯æ©Ÿèƒ½
    function toggleLock(status) {
        const screen = document.getElementById('lock-screen');
        if (status) {
            screen.style.display = 'flex';
            if (document.documentElement.requestFullscreen) {
                document.documentElement.requestFullscreen().catch(() => {});
            }
        } else {
            screen.style.display = 'none';
        }
    }

    // é•·æŠ¼ã—è§£é™¤å‡¦ç†
    const unlockTrigger = document.getElementById('unlock-trigger');
    const startUnlock = () => {
        unlockTrigger.style.background = "#555";
        lockTimer = setTimeout(() => {
            toggleLock(false);
            unlockTrigger.style.background = "#222";
        }, 1200);
    };
    const cancelUnlock = () => {
        clearTimeout(lockTimer);
        unlockTrigger.style.background = "#222";
    };

    unlockTrigger.addEventListener('mousedown', startUnlock);
    unlockTrigger.addEventListener('mouseup', cancelUnlock);
    unlockTrigger.addEventListener('touchstart', (e) => { e.preventDefault(); startUnlock(); });
    unlockTrigger.addEventListener('touchend', cancelUnlock);

</script>
</body>
</html>
