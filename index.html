<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SCRIPT VIEWER -BLACK-</title>
    <style>
        :root {
            --bg-color: #000000;
            --panel-color: #111111;
            --border-color: #333333;
            --accent-color: #ffffff;
            --text-color: #ffffff;
        }

        body, html {
            margin: 0; padding: 0; height: 100%; width: 100%;
            font-family: 'Courier New', Consolas, monospace; /* 角ばったフォント */
            background: var(--bg-color); color: var(--text-color);
            overflow: hidden;
        }

        .container { display: flex; height: 100vh; width: 100vw; }

        /* PDF表示エリア */
        #viewer-area { flex-grow: 1; background: #000; position: relative; }
        iframe { width: 100%; height: 100%; border: none; filter: invert(0); }

        /* 右側サイドパネル */
        #sidebar {
            width: 350px; background: var(--panel-color);
            display: flex; flex-direction: column; border-left: 1px solid var(--border-color);
        }

        /* 右上時計 */
        #side-clock {
            padding: 15px; font-size: 2rem; font-weight: bold;
            text-align: right; border-bottom: 2px solid var(--border-color);
            background: #000; letter-spacing: 2px;
        }

        .config-area { padding: 15px; border-bottom: 1px solid var(--border-color); }
        .config-area label { font-size: 0.7rem; color: #888; display: block; margin-bottom: 5px; }
        .config-area input {
            width: 100%; background: #000; border: 1px solid var(--border-color); color: white;
            padding: 10px; box-sizing: border-box; border-radius: 0; /* 角を立たせる */
        }

        /* ファイルリスト（スクロール可能） */
        #file-list { flex-grow: 1; overflow-y: auto; padding: 10px; }
        .file-item {
            background: #000; margin-bottom: 2px; padding: 12px;
            border: 1px solid var(--border-color);
            display: flex; align-items: center; border-radius: 0;
        }
        .file-item.active { border: 1px solid var(--accent-color); background: #222; }
        .file-name { flex-grow: 1; cursor: pointer; font-size: 0.9rem; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
        
        /* 並び替え・編集ボタン */
        .item-controls { display: flex; gap: 5px; margin-left: 10px; }
        .mini-btn { 
            background: #000; border: 1px solid #444; color: #fff; 
            padding: 5px; cursor: pointer; font-size: 0.7rem; min-width: 25px; text-align: center;
        }
        .mini-btn:active { background: #fff; color: #000; }

        /* 下部操作ボタン */
        .controls { padding: 15px; background: #000; border-top: 1px solid var(--border-color); }
        .btn {
            display: block; width: 100%; padding: 15px; margin-bottom: 10px;
            border: 1px solid var(--accent-color); background: #000; color: #fff;
            cursor: pointer; font-size: 0.9rem; font-weight: bold; border-radius: 0;
            text-transform: uppercase;
        }
        .btn:active { background: #fff; color: #000; }
        .btn-lock { background: #300; border-color: #f00; color: #f66; }

        /* ロック画面 */
        #lock-screen {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #000; z-index: 10000; flex-direction: column;
            justify-content: center; align-items: center; text-align: center;
        }
        #lock-perf-name { font-size: 1.5rem; color: #666; margin-bottom: 10px; border: 1px solid #333; padding: 10px 40px; }
        #lock-clock { font-size: 10rem; font-weight: bold; color: #fff; margin-bottom: 30px; }
        #unlock-btn { width: 300px; padding: 20px; border: 1px solid #444; background: #000; color: #444; cursor: pointer; }

        /* モーダル */
        .modal {
            display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
            background: #000; padding: 30px; border: 2px solid var(--accent-color); z-index: 1001; width: 320px;
        }
        .modal-mask { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 1000; }
        select, .modal input { width: 100%; padding: 12px; margin-bottom: 15px; background: #000; border: 1px solid var(--border-color); color: #fff; border-radius: 0; }
    </style>
</head>
<body>

<div id="lock-screen">
    <div id="lock-perf-name">NO TITLE</div>
    <div id="lock-clock">00:00:00</div>
    <div id="unlock-btn">HOLD TO UNLOCK</div>
</div>

<div class="container">
    <div id="viewer-area">
        <iframe id="pdf-viewer" src=""></iframe>
    </div>

    <div id="sidebar">
        <div id="side-clock">00:00:00</div>
        
        <div class="config-area">
            <label>PERFORMANCE NAME</label>
            <input type="text" id="perf-input" placeholder="未設定" oninput="updatePerfName()">
        </div>
        
        <div id="file-list"></div>
        
        <div class="controls">
            <input type="file" id="file-input" accept="application/pdf" multiple style="display:none;" onchange="handleFiles(this.files)">
            <button class="btn" onclick="document.getElementById('file-input').click()">+ ADD PDF FILES</button>
            <button class="btn btn-lock" onclick="toggleLock(true)">LOCK SYSTEM</button>
        </div>
    </div>
</div>

<div class="modal-mask" id="modal-mask" onclick="closeModal()"></div>
<div class="modal" id="edit-modal">
    <label style="font-size: 0.7rem;">SELECT CATEGORY</label>
    <select id="preset-select" onchange="document.getElementById('edit-name-input').value=this.value">
        <option value="">カスタム入力</option>
        <option value="台本">台本</option>
        <option value="仕込み図">仕込み図</option>
        <option value="Cueリスト">Cueリスト</option>
        <option value="機材リスト">機材リスト</option>
        <option value="電源">電源</option>
        <option value="タイムスケジュール">タイムスケジュール</option>
        <option value="香盤表">香盤表</option>
        <option value="舞台図面">舞台図面</option>
    </select>
    <input type="text" id="edit-name-input">
    <button class="btn" onclick="saveNewName()">UPDATE NAME</button>
</div>

<script>
    let files = [];
    let currentEditIndex = null;
    let lockTimer;

    function updateClock() {
        const now = new Date();
        const timeStr = now.toTimeString().split(' ')[0];
        document.getElementById('side-clock').textContent = timeStr;
        document.getElementById('lock-clock').textContent = timeStr;
    }
    setInterval(updateClock, 1000);
    updateClock();

    function updatePerfName() {
        document.getElementById('lock-perf-name').textContent = document.getElementById('perf-input').value || "NO TITLE";
    }

    function handleFiles(selectedFiles) {
        for (let file of selectedFiles) {
            files.push({ name: file.name, url: URL.createObjectURL(file) });
        }
        renderList();
        if (files.length === selectedFiles.length) loadPDF(0);
    }

    function moveItem(index, direction) {
        if (direction === -1 && index > 0) {
            [files[index], files[index - 1]] = [files[index - 1], files[index]];
        } else if (direction === 1 && index < files.length - 1) {
            [files[index], files[index + 1]] = [files[index + 1], files[index]];
        }
        renderList();
    }

    function renderList() {
        const list = document.getElementById('file-list');
        list.innerHTML = '';
        files.forEach((file, i) => {
            const item = document.createElement('div');
            item.className = 'file-item' + (document.getElementById('pdf-viewer').src.includes(file.url) ? ' active' : '');
            item.innerHTML = `
                <div class="file-name" onclick="loadPDF(${i})">${file.name}</div>
                <div class="item-controls">
                    <div class="mini-btn" onclick="moveItem(${i}, -1)">▲</div>
                    <div class="mini-btn" onclick="moveItem(${i}, 1)">▼</div>
                    <div class="mini-btn" onclick="openEditModal(${i})">EDIT</div>
                </div>
            `;
            list.appendChild(item);
        });
    }

    function loadPDF(index) {
        if (files[index]) {
            document.getElementById('pdf-viewer').src = files[index].url + "#toolbar=1";
            renderList();
        }
    }

    function openEditModal(index) {
        currentEditIndex = index;
        document.getElementById('edit-name-input').value = files[index].name;
        document.getElementById('modal-mask').style.display = 'block';
        document.getElementById('edit-modal').style.display = 'block';
    }

    function closeModal() {
        document.getElementById('modal-mask').style.display = 'none';
        document.getElementById('edit-modal').style.display = 'none';
    }

    function saveNewName() {
        const newName = document.getElementById('edit-name-input').value;
        if (newName) {
            files[currentEditIndex].name = newName;
            renderList();
            closeModal();
        }
    }

    function toggleLock(status) {
        const screen = document.getElementById('lock-screen');
        if (status) {
            screen.style.display = 'flex';
            document.documentElement.requestFullscreen?.();
        } else {
            screen.style.display = 'none';
        }
    }

    // 長押し解除
    const unlockBtn = document.getElementById('unlock-btn');
    const startUnlock = () => {
        unlockBtn.style.color = "#fff";
        unlockBtn.style.borderColor = "#fff";
        lockTimer = setTimeout(() => toggleLock(false), 1200);
    };
    const cancelUnlock = () => {
        clearTimeout(lockTimer);
        unlockBtn.style.color = "#444";
        unlockBtn.style.borderColor = "#444";
    };

    unlockBtn.addEventListener('mousedown', startUnlock);
    unlockBtn.addEventListener('mouseup', cancelUnlock);
    unlockBtn.addEventListener('touchstart', (e) => { e.preventDefault(); startUnlock(); });
    unlockBtn.addEventListener('touchend', cancelUnlock);
</script>
</body>
</html>
