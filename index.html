<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Stage Script Viewer</title>
    <style>
        :root {
            --bg-color: #1a1a1a;
            --panel-color: #2d2d2d;
            --accent-color: #007bff;
            --text-color: #ffffff;
        }

        body, html {
            margin: 0; padding: 0; height: 100%; width: 100%;
            font-family: sans-serif; background: var(--bg-color); color: var(--text-color);
            overflow: hidden;
        }

        /* æ™‚è¨ˆï¼ˆä¸Šéƒ¨ä¸­å¤®ï¼‰ */
        #clock {
            position: fixed; top: 0; left: 50%; transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.7); padding: 5px 20px;
            border-bottom-left-radius: 10px; border-bottom-right-radius: 10px;
            font-family: 'Courier New', Courier, monospace; font-size: 1.5rem;
            z-index: 1000; pointer-events: none;
        }

        /* ãƒ¡ã‚¤ãƒ³ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ */
        .container { display: flex; height: 100vh; width: 100vw; }

        /* PDFè¡¨ç¤ºã‚¨ãƒªã‚¢ */
        #viewer-area { flex-grow: 1; background: #525659; position: relative; }
        iframe { width: 100%; height: 100%; border: none; }

        /* å³å´ã‚µã‚¤ãƒ‰ãƒ‘ãƒãƒ« */
        #sidebar {
            width: 300px; background: var(--panel-color);
            display: flex; flex-direction: column; border-left: 2px solid #444;
            transition: transform 0.3s;
        }

        .panel-header { padding: 15px; background: #3d3d3d; text-align: center; font-weight: bold; }

        #file-list { flex-grow: 1; overflow-y: auto; padding: 10px; }
        .file-item {
            background: #444; margin-bottom: 8px; padding: 12px;
            border-radius: 8px; cursor: pointer; display: flex; justify-content: space-between;
        }
        .file-item:hover { background: #555; }
        .file-item.active { border: 2px solid var(--accent-color); background: #505050; }

        /* æ“ä½œã‚¨ãƒªã‚¢ */
        .controls { padding: 15px; border-top: 1px solid #444; }
        input[type="file"] { display: none; }
        .btn {
            display: block; width: 100%; padding: 12px; margin-bottom: 10px;
            border: none; border-radius: 8px; cursor: pointer; text-align: center;
            font-size: 1rem; font-weight: bold;
        }
        .btn-upload { background: var(--accent-color); color: white; }
        .btn-lock { background: #dc3545; color: white; }
        .btn-lock.locked { background: #28a745; }

        /* ãƒ­ãƒƒã‚¯ç”¨ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ */
        #lock-overlay {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.01); z-index: 9999; cursor: not-allowed;
        }

        /* ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ç”¨ãƒ¢ãƒ¼ãƒ€ãƒ« */
        #upload-modal {
            display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
            background: #333; padding: 20px; border-radius: 15px; z-index: 10001; box-shadow: 0 0 20px rgba(0,0,0,0.5);
            width: 80%; max-width: 400px;
        }
        .modal-mask {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8); z-index: 10000;
        }
        select, input[type="text"] {
            width: 100%; padding: 10px; margin: 10px 0; border-radius: 5px; border: none;
        }
    </style>
</head>
<body>

<div id="clock">00:00:00</div>

<div id="lock-overlay"></div>

<div class="container">
    <div id="viewer-area">
        <iframe id="pdf-viewer" src=""></iframe>
    </div>

    <div id="sidebar">
        <div class="panel-header">ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§</div>
        <div id="file-list">
            <p style="text-align:center; color: #888;">ãƒ•ã‚¡ã‚¤ãƒ«ãŒã‚ã‚Šã¾ã›ã‚“</p>
        </div>
        
        <div class="controls">
            <button class="btn btn-upload" onclick="openModal()">ï¼‹ ãƒ•ã‚¡ã‚¤ãƒ«è¿½åŠ </button>
            <button id="lock-btn" class="btn btn-lock" onclick="toggleLock()">ğŸ”’ ç”»é¢ãƒ­ãƒƒã‚¯</button>
        </div>
    </div>
</div>

<div class="modal-mask" id="modal-mask"></div>
<div id="upload-modal">
    <h3>ãƒ•ã‚¡ã‚¤ãƒ«è¨­å®š</h3>
    <label>è¡¨ç¤ºåã‚’é¸æŠã¾ãŸã¯å…¥åŠ›:</label>
    <select id="name-presets" onchange="syncName()">
        <option value="">(ãã®ã¾ã¾ã®ãƒ•ã‚¡ã‚¤ãƒ«å)</option>
        <option value="å°æœ¬">å°æœ¬</option>
        <option value="é€²è¡Œè¡¨">é€²è¡Œè¡¨</option>
        <option value="é¦™ç›¤è¡¨">é¦™ç›¤è¡¨</option>
        <option value="éŸ³éŸ¿ãƒªã‚¹ãƒˆ">éŸ³éŸ¿ãƒªã‚¹ãƒˆ</option>
        <option value="ç…§æ˜ãƒ—ãƒ­ãƒƒãƒˆ">ç…§æ˜ãƒ—ãƒ­ãƒƒãƒˆ</option>
        <option value="ã‚«ã‚¹ã‚¿ãƒ ">ç›´æ¥å…¥åŠ›ã™ã‚‹...</option>
    </select>
    <input type="text" id="custom-name" placeholder="è¡¨ç¤ºåã‚’å…¥åŠ›">
    <input type="file" id="file-input" accept="application/pdf" onchange="handleFileUpload()">
    <button class="btn btn-upload" onclick="document.getElementById('file-input').click()">ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦å®Œäº†</button>
    <button class="btn" onclick="closeModal()" style="background:#666; color:white;">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
</div>

<script>
    let files = [];
    let isLocked = false;

    // æ™‚è¨ˆã®æ›´æ–°
    function updateClock() {
        const now = new Date();
        const timeStr = now.getHours().toString().padStart(2, '0') + ':' +
                        now.getMinutes().toString().padStart(2, '0') + ':' +
                        now.getSeconds().toString().padStart(2, '0');
        document.getElementById('clock').textContent = timeStr;
    }
    setInterval(updateClock, 1000);
    updateClock();

    // ãƒ¢ãƒ¼ãƒ€ãƒ«æ“ä½œ
    function openModal() {
        document.getElementById('modal-mask').style.display = 'block';
        document.getElementById('upload-modal').style.display = 'block';
    }

    function closeModal() {
        document.getElementById('modal-mask').style.display = 'none';
        document.getElementById('upload-modal').style.display = 'none';
        document.getElementById('custom-name').value = '';
    }

    function syncName() {
        const preset = document.getElementById('name-presets').value;
        if (preset !== "ã‚«ã‚¹ã‚¿ãƒ " && preset !== "") {
            document.getElementById('custom-name').value = preset;
        }
    }

    // ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å‡¦ç†
    function handleFileUpload() {
        const fileInput = document.getElementById('file-input');
        const customName = document.getElementById('custom-name').value;
        
        if (fileInput.files.length > 0) {
            const file = fileInput.files[0];
            const fileName = customName || file.name;
            const fileURL = URL.createObjectURL(file);
            
            files.push({ name: fileName, url: fileURL });
            renderFileList();
            loadPDF(fileURL, files.length - 1);
            closeModal();
        }
    }

    // ãƒªã‚¹ãƒˆæç”»
    function renderFileList() {
        const listContainer = document.getElementById('file-list');
        listContainer.innerHTML = '';
        files.forEach((file, index) => {
            const div = document.createElement('div');
            div.className = 'file-item';
            div.innerHTML = `<span>${file.name}</span>`;
            div.onclick = () => loadPDF(file.url, index);
            listContainer.appendChild(div);
        });
    }

    // PDFèª­ã¿è¾¼ã¿
    function loadPDF(url, index) {
        if (isLocked) return;
        const viewer = document.getElementById('pdf-viewer');
        // ãƒ–ãƒ©ã‚¦ã‚¶æ¨™æº–ã®PDFãƒ“ãƒ¥ãƒ¼ãƒ¯ãƒ¼ã‚’ä½¿ç”¨ï¼ˆ#toolbar=1 ã§æ›¸ãè¾¼ã¿ãƒ„ãƒ¼ãƒ«ãŒè¡¨ç¤ºã•ã‚Œã‚‹å ´åˆãŒã‚ã‚‹ï¼‰
        viewer.src = url + "#toolbar=1";
        
        const items = document.querySelectorAll('.file-item');
        items.forEach((item, i) => {
            item.classList.toggle('active', i === index);
        });
    }

    // ãƒ­ãƒƒã‚¯æ©Ÿèƒ½
    function toggleLock() {
        isLocked = !isLocked;
        const overlay = document.getElementById('lock-overlay');
        const btn = document.getElementById('lock-btn');
        const sidebar = document.getElementById('sidebar');

        if (isLocked) {
            overlay.style.display = 'block';
            btn.textContent = 'ğŸ”“ ãƒ­ãƒƒã‚¯è§£é™¤ï¼ˆé•·æŠ¼ã—ï¼‰';
            btn.classList.add('locked');
            // ãƒ­ãƒƒã‚¯ä¸­ã¯ã‚µã‚¤ãƒ‰ãƒãƒ¼ã‚’å°‘ã—æš—ãã™ã‚‹ãªã©ã®è¦–è¦šåŠ¹æœ
            sidebar.style.opacity = "0.5";
        } else {
            overlay.style.display = 'none';
            btn.textContent = 'ğŸ”’ ç”»é¢ãƒ­ãƒƒã‚¯';
            btn.classList.remove('locked');
            sidebar.style.opacity = "1";
        }
    }

    // ãƒ­ãƒƒã‚¯è§£é™¤ã®èª¤æ“ä½œé˜²æ­¢ï¼ˆé•·æŠ¼ã—ã§è§£é™¤ï¼‰
    let lockTimer;
    const lockBtn = document.getElementById('lock-btn');
    lockBtn.addEventListener('mousedown', () => { if(isLocked) lockTimer = setTimeout(toggleLock, 1000); });
    lockBtn.addEventListener('mouseup', () => clearTimeout(lockTimer));
    lockBtn.addEventListener('touchstart', () => { if(isLocked) lockTimer = setTimeout(toggleLock, 1000); });
    lockBtn.addEventListener('touchend', () => clearTimeout(lockTimer));

</script>
</body>
</html>
